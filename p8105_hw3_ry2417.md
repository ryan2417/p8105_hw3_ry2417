p8105\_hw3\_ry2417
================
Ruiqi Yan
10/12/2021

load `tidyverse` package and set global options of code chunk and figure

``` r
library(tidyverse)

knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  fig.width = 6,
  fig.asp = .7,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

load `p8105.datasets` package

``` r
library(p8105.datasets)
```

## Problem 1

load `instacart` data and tidy the data to data frame of problem 1

``` r
data("instacart")
p1_df <- 
  instacart %>% 
  mutate(
    order_dow = lubridate::wday(order_dow + 1,
                                label = TRUE,
                                abbr = FALSE
                                )
  ) %>% 
  arrange(user_id, order_number) %>% 
  relocate(user_id, order_number, product_name, aisle, department, everything())
```

Some numerical summary of data

``` r
num_user <-
  p1_df %>% 
  select(user_id) %>% 
  distinct() %>% 
  nrow()

num_order <-
  p1_df %>% 
  select(order_id) %>% 
  distinct() %>% 
  nrow()

num_product <-
  p1_df %>% 
  select(product_name) %>% 
  distinct() %>% 
  nrow()

average_prior_order_day <-
  p1_df %>% 
  group_by(user_id) %>% 
  summarise(
    prior_order_day = sum(days_since_prior_order)/n()
  ) %>% 
  pull(prior_order_day) %>% 
  mean() %>% 
  round()

most_order_dow <-
  p1_df %>% 
  group_by(order_dow) %>% 
  distinct(order_id) %>% 
  summarise(
    num_order = n()
  ) %>% 
  filter(num_order == max(num_order)) %>% 
  pull(order_dow)
  
num_dptm <-
  p1_df %>% 
  select(department) %>% 
  distinct() %>% 
  nrow()

some_dptm <- 
  p1_df %>% 
  select(department) %>% 
  distinct() %>% 
  head(10) %>% 
  pull()

num_aisle <- 
  p1_df %>% 
  select(aisle) %>% 
  distinct() %>% 
  nrow()
  
most_item_aisle <- 
  p1_df %>% 
  group_by(aisle) %>% 
  summarise(
    num_item = n()
  ) %>% 
  arrange(desc(num_item)) %>% 
  head(5) %>% 
  pull(aisle)

most_reorder_product <-
  p1_df %>% 
  group_by(product_name) %>% 
  summarise(
    num_reorder = sum(reordered)
  ) %>% 
  arrange(desc(num_reorder)) %>% 
  head(10) %>% 
  pull(product_name)
```

Some tables generated from data

``` r
example_obs_p1 <-
  p1_df %>% 
  head(10) %>% 
  select(user_id, 
         order_id, 
         product_name, 
         aisle, 
         department,
         order_dow,
         order_hour_of_day
  ) %>% 
  head(10) %>% 
  knitr::kable()

most_popular_product <- 
  p1_df %>% 
  group_by(product_name) %>% 
  distinct(order_id) %>% 
  summarise(
    num_product_order = n()
  ) %>% 
  arrange(desc(num_product_order)) %>% 
  head(10) %>% 
  knitr::kable()

most_popular_product_by_dptm <-
  p1_df %>% 
  group_by(department, product_name) %>% 
  distinct(order_id) %>% 
  summarise(
    num_order = n()
  ) %>% 
  mutate(
    product_rank = min_rank(desc(num_order))
  ) %>% 
  select(-num_order) %>% 
  filter(product_rank < 6) %>% 
  head(40) %>% 
  pivot_wider(
    names_from = department,
    values_from = product_name
  ) %>% 
  arrange(product_rank) %>% 
  knitr::kable()

most_popular_product_by_aisle <-
  p1_df %>% 
  filter(aisle %in% c("baking ingredients",
                      "dog food care",
                      "packaged vegetables fruits")) %>% 
  group_by(aisle, product_name) %>% 
  summarise(
    num_times = n()
  ) %>% 
  mutate(
    product_rank = min_rank(desc(num_times))
  ) %>% 
  filter(product_rank < 4) %>% 
  arrange(product_rank) %>% 
  pivot_wider(
    names_from = product_rank,
    values_from = c(product_name, num_times),
    names_glue = "Rank_{product_rank}_{.value}"
  ) %>% 
  knitr::kable()

mean_hour_of_day_dow <-
  p1_df %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarise(
    mean_hour_of_day = mean(order_hour_of_day)
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour_of_day
  ) %>% 
  knitr::kable()
```

`instacart`data contains 1384617 observations of 15 variables. The
variables name are
`user_id, order_number, product_name, aisle, department, order_id, product_id, add_to_cart_order, reordered, eval_set, order_dow, order_hour_of_day, days_since_prior_order, aisle_id, department_id`.
There are 131209 users, 131209 orders, 39123 different products, 21
categories of products and 134 aisles . The categories of products
include beverages, dairy eggs, household, snacks, breakfast, deli,
frozen, produce, personal care, canned goods. Most of items were order
aisles `most_item_aisle`. Here are some examples of observations

| user\_id | order\_id | product\_name                    | aisle                  | department | order\_dow | order\_hour\_of\_day |
|---------:|----------:|:---------------------------------|:-----------------------|:-----------|:-----------|---------------------:|
|        1 |   1187899 | Soda                             | soft drinks            | beverages  | Thursday   |                    8 |
|        1 |   1187899 | Organic String Cheese            | packaged cheese        | dairy eggs | Thursday   |                    8 |
|        1 |   1187899 | 0% Greek Strained Yogurt         | yogurt                 | dairy eggs | Thursday   |                    8 |
|        1 |   1187899 | XL Pick-A-Size Paper Towel Rolls | paper goods            | household  | Thursday   |                    8 |
|        1 |   1187899 | Milk Chocolate Almonds           | candy chocolate        | snacks     | Thursday   |                    8 |
|        1 |   1187899 | Pistachios                       | nuts seeds dried fruit | snacks     | Thursday   |                    8 |
|        1 |   1187899 | Cinnamon Toast Crunch            | cereal                 | breakfast  | Thursday   |                    8 |
|        1 |   1187899 | Aged White Cheddar Popcorn       | popcorn jerky          | snacks     | Thursday   |                    8 |
|        1 |   1187899 | Organic Whole Milk               | milk                   | dairy eggs | Thursday   |                    8 |
|        1 |   1187899 | Organic Half & Half              | cream                  | dairy eggs | Thursday   |                    8 |

The products that has most reordering users were Banana, Bag of Organic
Bananas, Organic Strawberries, Organic Baby Spinach, Organic Avocado,
Organic Hass Avocado, Large Lemon, Strawberries, Organic Raspberries,
Limes. Here is the table of the most popular products and the number of
times being ordered

| product\_name          | num\_product\_order |
|:-----------------------|--------------------:|
| Banana                 |               18726 |
| Bag of Organic Bananas |               15480 |
| Organic Strawberries   |               10894 |
| Organic Baby Spinach   |                9784 |
| Large Lemon            |                8135 |
| Organic Avocado        |                7409 |
| Organic Hass Avocado   |                7293 |
| Strawberries           |                6494 |
| Limes                  |                6033 |
| Organic Raspberries    |                5546 |

The three most popular items in each of the aisles “baking ingredients”,
“dog food care”, and “packaged vegetables fruits” are listed here

| aisle                      | Rank\_1\_product\_name                        | Rank\_2\_product\_name              | Rank\_3\_product\_name | Rank\_1\_num\_times | Rank\_2\_num\_times | Rank\_3\_num\_times |
|:---------------------------|:----------------------------------------------|:------------------------------------|:-----------------------|--------------------:|--------------------:|--------------------:|
| baking ingredients         | Light Brown Sugar                             | Pure Baking Soda                    | Cane Sugar             |                 499 |                 387 |                 336 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats | Organix Chicken & Brown Rice Recipe | Small Dog Biscuits     |                  30 |                  28 |                  26 |
| packaged vegetables fruits | Organic Baby Spinach                          | Organic Raspberries                 | Organic Blueberries    |                9784 |                5546 |                4966 |

The most popular items in some departments are shown below

| product\_rank | alcohol            | babies                                           | bakery                                         | beverages                       | breakfast                         | bulk                       | canned goods              | dairy eggs                      |
|--------------:|:-------------------|:-------------------------------------------------|:-----------------------------------------------|:--------------------------------|:----------------------------------|:---------------------------|:--------------------------|:--------------------------------|
|             1 | Sauvignon Blanc    | Baby Food Stage 2 Blueberry Pear & Purple Carrot | 100% Whole Wheat Bread                         | Sparkling Water Grapefruit      | Honey Nut Cheerios                | Dried Mango                | Organic Black Beans       | Organic Whole Milk              |
|             2 | Cabernet Sauvignon | Spinach Peas & Pear Stage 2 Baby Food            | Organic Bread with 21 Whole Grains             | Spring Water                    | Organic Old Fashioned Rolled Oats | Organic Rolled Oats        | No Salt Added Black Beans | Organic Half & Half             |
|             3 | Beer               | Gluten Free SpongeBob Spinach Littles            | Sourdough Bread                                | Lime Sparkling Water            | Raisin Bran Cereal                | Organic Black Mission Figs | Organic Garbanzo Beans    | Half & Half                     |
|             4 | Chardonnay         | Free & Clear Unscented Baby Wipes                | Ezekiel 4:9 Bread Organic Sprouted Whole Grain | Sparkling Natural Mineral Water | Cereal                            | Apricots                   | Organic Diced Tomatoes    | Organic Unsweetened Almond Milk |
|             5 | Vodka              | Broccoli & Apple Stage 2 Baby Food               | Original Nooks & Crannies English Muffins      | Soda                            | Organic Cinnamon Crunch Cereal    | Rolled Oats                | Black Beans               | Unsweetened Almondmilk          |

The day of the week when most orders were placed is Sunday. The average
days since prior order per user are 17 days. The table showing the mean
hour of the day at which Pink Lady Apples and Coffee Ice Cream are
ordered on each day of the week is

| product\_name    |   Sunday |   Monday |  Tuesday | Wednesday | Thursday |   Friday | Saturday |
|:-----------------|---------:|---------:|---------:|----------:|---------:|---------:|---------:|
| Coffee Ice Cream | 13.77419 | 14.31579 | 15.38095 |  15.31818 | 15.21739 | 12.26316 | 13.83333 |
| Pink Lady Apples | 13.44118 | 11.36000 | 11.70213 |  14.25000 | 11.55172 | 12.78431 | 11.93750 |

Make a plot that shows the number of items ordered in each aisle,
limiting this to aisles with more than 10000 items ordered.

``` r
p1_df %>% 
  group_by(aisle) %>% 
  summarise(
    num_item = n()
  ) %>% 
  filter(num_item >= 10000) %>% 
  ggplot(aes(x = aisle, y = num_item)) +
  geom_bar(stat = "identity", alpha = 0.5) +
  labs(x = "aisle name",
       y = "number of items ordered",
       title = "The Number of Items Ordered in Each Aisle(>= 10000)",
       caption = "Data from instacart of p8105_datasets package ") +
  theme(
    axis.text.x = element_text(angle = 90, size = 6),
    axis.text.y = element_text(size = 6),
    axis.title = element_text(size = 7),
    plot.title = element_text(size = 7),
    plot.caption = element_text(size = 4)
  )
```

<img src="p8105_hw3_ry2417_files/figure-gfm/problem_1_plot-1.png" width="90%" />

## Problem 2

load `brfss_smart2010` data

``` r
data("brfss_smart2010")
```

clean `brfss_smart2010` data and assign to data frame of problem 2

``` r
p2_df <- 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  rename(
    state = locationabbr,
    location = locationdesc
  ) %>% 
  filter(topic == "Overall Health") %>% 
  mutate(
    response = factor(response, 
                      levels = c("Poor", 
                                 "Fair",
                                 "Good",
                                 "Very good",
                                 "Excellent"),
                      ordered = TRUE
                      )
  )
```

``` r
state_7_more_2002 <-
  p2_df %>% 
  filter(year == 2002) %>% 
  group_by(state) %>% 
  distinct(location) %>% 
  summarise(num_location = n()) %>% 
  filter(num_location >= 7) %>% 
  pull(state)

state_7_more_2010 <-
  p2_df %>% 
  filter(year == 2010) %>% 
  group_by(state) %>% 
  distinct(location) %>% 
  summarise(num_location = n()) %>% 
  filter(num_location >= 7) %>% 
  pull(state)
```

In 2002, states that were observed at 7 or more locations are CT, FL,
MA, NC, NJ, PA. In 2010, states that were observed at 7 or more
locations are CA, CO, FL, MA, MD, NC, NE, NJ, NY, OH, PA, SC, TX, WA.

Make a “spaghetti” plot of the average data value over time within a
state

``` r
excellent_df <- 
  p2_df %>% 
  filter(response == "Excellent") %>% 
  group_by(state, year) %>% 
  summarise(
    mean_data_value = mean(data_value, na.rm = TRUE)
  )
excellent_df %>% 
  ggplot(aes(x = year, y = mean_data_value, color = state)) +
  geom_line(alpha = 0.5) +
  labs(
    y = "average data value",
    title = "Average Value over Time within Each States",
    caption = "Data from BRFSS of p8105_datasets package "
  ) +
  theme(
    plot.caption = element_text(size = 5),
    legend.key.size = unit(0.4, "cm"),
    legend.text = element_text(size = 5)
  ) +
  guides(color = guide_legend(nrow = 4))
```

<img src="p8105_hw3_ry2417_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

Make a two-panel plot showing, for the years 2006, and 2010,
distribution of data\_value for responses (“Poor” to “Excellent”) among
locations in NY State

``` r
p2_df %>% 
  filter(year %in% c(2006, 2010), state == "NY") %>% 
  ggplot(aes(x = data_value, fill = response)) +
  geom_density(alpha = .3) +
  facet_grid(. ~ year) +
  labs(y = "density of data value",
       x = "data value",
    title = "Distribution of Data Value for Reponse among New York State in 2006 vs. 2010",
    caption = "Data from BRFSS of p8105_datasets package ") +
  theme(
    plot.title = element_text(size = 11),
    plot.caption = element_text(size = 5),
    legend.key.size = unit(0.4, "cm")
  )
```

<img src="p8105_hw3_ry2417_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" />

## Problem 3

import and clean data set for problem 3 from data `accel_data`

``` r
p3_df <- 
  read_csv(
    "data/accel_data.csv",
    col_types = cols(`day_id` = col_factor(ordered = TRUE))
  ) %>% 
  janitor::clean_names() %>% 
  rename(
    day_of_week = day,
    day = day_id
  ) %>% 
  pivot_longer( 
    starts_with("activity_"),
    names_to = "minute_of_day",
    names_prefix = "activity_",
    values_to = "activity_in_minute"
  ) %>% 
  mutate(
    minute_of_day = factor(minute_of_day, ordered = TRUE),
    week_vs_weekend = ifelse(day %in% c("Sunday", "Saturday"), "weekend", "week")
  )
```

Some numerical descriptions of data

``` r
average_activity <-
  p3_df %>% 
  pull(activity_in_minute) %>% 
  mean()

example_obs_p3 <-
  p3_df %>% 
  head(10) %>% 
  knitr::kable()
```

There are 50400 observations of 6 variables in data. Each observation is
the observation of one minute collected on a 63 year-old male. The
variables include week, day, day\_of\_week, minute\_of\_day,
activity\_in\_minute, week\_vs\_weekend. The average activity count per
minute is 267.0440592. Here is the examples of some observations

| week | day | day\_of\_week | minute\_of\_day | activity\_in\_minute | week\_vs\_weekend |
|-----:|:----|:--------------|:----------------|---------------------:|:------------------|
|    1 | 1   | Friday        | 1               |             88.37778 | week              |
|    1 | 1   | Friday        | 2               |             82.24444 | week              |
|    1 | 1   | Friday        | 3               |             64.44444 | week              |
|    1 | 1   | Friday        | 4               |             70.04444 | week              |
|    1 | 1   | Friday        | 5               |             75.04444 | week              |
|    1 | 1   | Friday        | 6               |             66.26667 | week              |
|    1 | 1   | Friday        | 7               |             53.75556 | week              |
|    1 | 1   | Friday        | 8               |             47.84444 | week              |
|    1 | 1   | Friday        | 9               |             55.46667 | week              |
|    1 | 1   | Friday        | 10              |             42.95556 | week              |
